<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LFJC Online Exam</title>
<style>
body{font-family:"SF Pro Display",Arial,sans-serif;margin:0;background:#fff;color:#000;}
header{background:linear-gradient(145deg,#E6E6FA,#D8BFD8);color:#4B0082;text-align:center;padding:20px;font-size:36px;font-weight:700;letter-spacing:1.5px;box-shadow:0 5px #aaa;text-shadow:0 1px 2px #fff;}
#studentEntry,#examArea{padding:20px;text-align:center;}
.form-group{display:flex;flex-direction:row;align-items:center;justify-content:center;margin-bottom:15px;}
.form-group label{font-size:1.15rem;font-weight:600;margin-right:10px;color:#4B0082;width:120px;text-align:right;}
input[type="text"]{padding:10px 12px;font-size:1.1rem;border-radius:10px;border:1.5px solid #4B0082;outline:none;min-width:250px;}
input.error{animation:glowRed 0.5s alternate infinite;border-color:red;}
@keyframes glowRed{0%{box-shadow:0 0 5px red;}100%{box-shadow:0 0 15px red;}}
button{position:relative;overflow:hidden;cursor:pointer;border:none;border-radius:12px;transition:all .18s ease;box-shadow:0 6px #aaa;background:linear-gradient(to bottom,#fafaff,#dcd6f7);color:#4B0082;font-weight:600;padding:10px 20px;font-size:18px;}
button:hover{transform:translateY(-2px);box-shadow:0 8px 15px rgba(0,0,0,.28);}
button:active{transform:translateY(3px) scale(.98);}
.optBtn{font-size:16px;padding:8px 18px;margin:6px;border:2px solid #4B0082;background:#fff;border-radius:8px;box-shadow:0 5px #aaa;}
.optBtn.selected{background:#32CD32;color:#fff;border-color:#2fa92f;}
.navContainer{display:flex;justify-content:center;gap:10px;margin:10px 0;flex-wrap:wrap}
.navBtn{font-size:16px;padding:10px 20px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;background:linear-gradient(145deg,#1E90FF,#4682B4);}
#markReviewBtn{background:linear-gradient(145deg,#ffb84d,#ff9900)}
#submitBtn{background:linear-gradient(145deg,#c8b88a,#b49e60)}
#timerEl{font-size:20px;font-weight:bold;color:#4B0082;padding:6px 12px;border-radius:6px;background:#f0f0ff;display:inline-block;transition: all 0.3s ease;}
#timerEl.blink{animation:blinkTimer 1s infinite;}
@keyframes blinkTimer{0%{background:#ff6666;color:#fff;}50%{background:#fff;color:#4B0082;}100%{background:#ff6666;color:#fff;}}
#paletteContainer button{width:36px;height:36px;border-radius:50%;font-size:14px;margin:3px;border:1px solid #4B0082;background:#E6E6FA;color:#4B0082;}
#paletteContainer button.selected{background:#32CD32;color:#fff;border-color:#2fa92f}
#paletteContainer button.reviewed{background:yellow;color:#000}
#paletteContainer button.current{border:3px solid red}
footer{background:#E6E6FA;color:#4B0082;padding:10px;text-align:center;font-weight:bold;position:fixed;width:100%;bottom:0;}
.sectionTitle{font-size:22px;color:#4B0082;font-weight:bold;margin-bottom:8px;}
img.questionImg{max-width:100%;border-radius:10px;}
.glow {animation: glowPulse 1.6s infinite alternate;box-shadow:0 8px 18px rgba(75,0,130,0.12);}
@keyframes glowPulse{0% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); } 50% { box-shadow:0 12px 30px rgba(75,0,130,0.14); transform:translateY(-2px); } 100% { box-shadow:0 6px 10px rgba(75,0,130,0.06); transform:translateY(0); }}
</style>
</head>
<body>
<header>LFJC ONLINE EXAMINATION</header>

<div id="studentEntry">
  <div class="form-group"><label>Name</label><input type="text" id="stuName" placeholder="Only letters & spaces" autocomplete="off"></div>
  <div class="form-group"><label>Section</label><input type="text" id="stuSection" placeholder="Letters & digits" autocomplete="off"></div>
  <div class="form-group"><label>Roll</label><input type="text" id="stuRoll" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><label>Admission No</label><input type="text" id="stuAdm" placeholder="Digits only" autocomplete="off"></div>
  <div class="form-group"><button id="stuStartBtn" style="display:none;">Start Exam</button></div>
</div>

<div id="examArea" style="display:none;">
  <div id="examHeader" style="display:flex;justify-content:space-between;align-items:center;">
    <div id="stuInfo" style="text-align:left;font-weight:bold;"></div>
    <div id="stuQInfo" style="text-align:center;"></div>
    <div id="timerEl">ðŸ•’ 00:00</div>
  </div>
  <div id="questionContainer" style="text-align:center;margin-top:10px;"></div>
  <div class="navContainer">
    <button class="navBtn" id="prevBtn">â¬… Previous</button>
    <button class="navBtn" id="markReviewBtn">Review</button>
    <button class="navBtn" id="nextBtn">Next âž¡</button>
    <button class="navBtn" id="submitBtn">Submit Exam</button>
  </div>
  <div id="paletteContainer"></div>
</div>

<footer>LFJC@2025 All rights reserved</footer>

<script>
let images=["1.png","2.png","3.png","4.png","5.png","6.png"];
let answerKey=["A","B","C","D","A","B"];
const subjects=["Maths","Physics","Chemistry"];
let examData={files:[],subjectNames:[],keys:[]};
let progress=null,timerInterval=null;

function shuffleArray(arr){const c=arr.slice();for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[c[i],c[j]]=[c[j],c[i]];}return c;}

function prepareExamData(){
  examData.files=[];examData.subjectNames=[];examData.keys=[];
  const total=images.length,base=Math.floor(total/3);let rem=total%3,start=0,groups=[];
  for(let s=0;s<3;s++){
    const count=base+(rem>0?1:0);rem--;
    const gImgs=images.slice(start,start+count);const gKeys=answerKey.slice(start,start+count);start+=count;
    const idxs=Array.from({length:gImgs.length},(_,i)=>i);const sh=shuffleArray(idxs);
    const shImgs=sh.map(i=>gImgs[i]);const shKeys=sh.map(i=>gKeys[i]);
    groups.push({name:subjects[s],imgs:shImgs,keys:shKeys});
  }
  const shGr=shuffleArray(groups);
  shGr.forEach(g=>{g.imgs.forEach((img,i)=>{examData.files.push(img);examData.keys.push(g.keys[i]);examData.subjectNames.push(g.name);});});
}

function validateStudentInputs(){
  const n=stuName,s=stuSection,r=stuRoll,a=stuAdm;
  let v1=/^[A-Za-z .]+$/.test(n.value),v2=/^[A-Za-z0-9]+$/.test(s.value),v3=/^[0-9]+$/.test(r.value),v4=/^[0-9]+$/.test(a.value);
  [n,s,r,a].forEach(el=>el.classList.remove('error'));
  if(!v1&&n.value!=="")n.classList.add('error');
  if(!v2&&s.value!=="")s.classList.add('error');
  if(!v3&&r.value!=="")r.classList.add('error');
  if(!v4&&a.value!=="")a.classList.add('error');
  const ok=v1&&v2&&v3&&v4;
  stuStartBtn.style.display=ok?'inline-block':'none';
  return ok;
}
['stuName','stuSection','stuRoll','stuAdm'].forEach(id=>document.getElementById(id).addEventListener('input',validateStudentInputs));

stuStartBtn.onclick=()=>{
  if(!validateStudentInputs())return;
  prepareExamData();
  progress={answers:Array(examData.files.length).fill(null),review:Array(examData.files.length).fill(false),currentIndex:0,student:{name:stuName.value},timeLeftSec:5*60};
  studentEntry.style.display='none';examArea.style.display='block';
  renderQuestion();renderPalette();startTimer();updateNavButtons();
};

function startTimer(){
  const t=timerEl;
  timerInterval=setInterval(()=>{
    if(progress.timeLeftSec<=0){clearInterval(timerInterval);submitExam();return;}
    progress.timeLeftSec--;
    let m=Math.floor(progress.timeLeftSec/60),sec=progress.timeLeftSec%60;
    t.textContent=`ðŸ•’ ${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    if(progress.timeLeftSec<=300)t.classList.add('blink');else t.classList.remove('blink');
  },1000);
}

function renderQuestion(){
  const q=questionContainer;
  const f=examData.files[progress.currentIndex];const subj=examData.subjectNames[progress.currentIndex];
  q.innerHTML=`<div class="sectionTitle">${subj} (Q ${progress.currentIndex+1}/${examData.files.length})</div><img src="${f}" class="questionImg"><br>`;
  ["A","B","C","D"].forEach(opt=>{
    const b=document.createElement('button');b.className='optBtn';b.textContent=opt;
    if(progress.answers[progress.currentIndex]===opt)b.classList.add('selected');
    b.onclick=()=>{
      if(progress.answers[progress.currentIndex]===opt)progress.answers[progress.currentIndex]=null;
      else progress.answers[progress.currentIndex]=opt;
      renderPalette();renderQuestion();
    };
    q.appendChild(b);
  });
}

prevBtn.onclick=()=>{if(progress.currentIndex>0){progress.currentIndex--;renderQuestion();renderPalette();updateNavButtons();}};
nextBtn.onclick=()=>{if(progress.currentIndex<examData.files.length-1){progress.currentIndex++;renderQuestion();renderPalette();updateNavButtons();}};
markReviewBtn.onclick=()=>{progress.review[progress.currentIndex]=!progress.review[progress.currentIndex];markReviewBtn.textContent=progress.review[progress.currentIndex]?"Unreview":"Review";renderPalette();};
submitBtn.onclick=()=>submitExam();

function updateNavButtons(){
  prevBtn.style.display=(progress.currentIndex===0)?'none':'inline-block';
  nextBtn.style.display=(progress.currentIndex===examData.files.length-1)?'none':'inline-block';
  markReviewBtn.textContent=progress.review[progress.currentIndex]?"Unreview":"Review";
}

function renderPalette(){
  const c=paletteContainer;c.innerHTML='';
  progress.answers.forEach((ans,i)=>{
    const b=document.createElement('button');b.textContent=i+1;
    if(progress.review[i])b.classList.add('reviewed');
    if(i===progress.currentIndex)b.classList.add('current');
    if(ans)b.classList.add('selected');
    b.onclick=()=>{progress.currentIndex=i;renderQuestion();renderPalette();updateNavButtons();};
    c.appendChild(b);
  });
}

function submitExam(){
  clearInterval(timerInterval);
  const subjData={};
  examData.subjectNames.forEach((s,i)=>{
    if(!subjData[s])subjData[s]={correct:0,wrong:0,blank:0,total:0};
    const ans=progress.answers[i];
    if(ans===null)subjData[s].blank++;
    else if(ans===examData.keys[i])subjData[s].correct++;
    else subjData[s].wrong++;
    subjData[s].total++;
  });

  let html=`<h2 style="color:#4B0082;">ðŸŽ‰ Congratulations, ${progress.student.name}</h2>
  <div style="display:flex;justify-content:center;width:100%;margin-top:20px;">
  <table border="1" style="border-collapse:collapse;width:90%;max-width:800px;text-align:center;font-size:18px;">
  <tr style="background:#E6E6FA;">
    <th>Subject</th><th>Correct</th><th>Wrong</th><th>Blank</th><th>Total</th><th>%</th>
  </tr>`;
  let totalCorrect=0,totalWrong=0,totalBlank=0,totalQs=0;
  for(let s in subjData){
    const v=subjData[s];const per=((v.correct/v.total)*100).toFixed(2);
    totalCorrect+=v.correct;totalWrong+=v.wrong;totalBlank+=v.blank;totalQs+=v.total;
    html+=`<tr><td>${s}</td><td>${v.correct}</td><td>${v.wrong}</td><td>${v.blank}</td><td>${v.total}</td><td>${per}%</td></tr>`;
  }
  const totalPercent=((totalCorrect/totalQs)*100).toFixed(2);
  html+=`<tr style="font-weight:bold;background:#D8BFD8;"><td>Total</td><td>${totalCorrect}</td><td>${totalWrong}</td><td>${totalBlank}</td><td>${totalQs}</td><td>${totalPercent}%</td></tr></table></div><br><button id="logoutBtn" class="glow">Logout</button>`;
  examArea.innerHTML=html;
  document.getElementById('logoutBtn').onclick=()=>{window.open('','_self');window.close();};
}
</script>
</body>
</html>
